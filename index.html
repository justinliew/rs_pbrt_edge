<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>hello-wasm example</title>
</head>

<body>
	<canvas id="framebuffer" width="500" height="500"></canvas>
	<div id="controls">
		Tile Size: <input id="tile_size" value="64" />
		<button id="render_button">Render</button>
		<select id="scenes">
			<option value="cornell">Cornell Box</option>
			<option value="killeroo">Killeroo</option>
		</select>
	</div>
	<script type="module">

		function get_scene(scene_id) {
			var xhttp = new XMLHttpRequest();
			xhttp.onload = function (oEvent) {
				var arraybuffer = xhttp.response;
				if (arraybuffer) {
					let tile_size = +document.getElementById("tile_size").value;

					var byteArray = new Uint8Array(arraybuffer);
					var string = new TextDecoder().decode(byteArray);
					let output = lib_entry(tile_size, string);

					var canvas = document.getElementById("framebuffer");
					canvas.width = 700; // TODO get the width and height from lib_entry in the future
					canvas.height = 700;
				}
			};

			var url = "content/" + scene_id + "/main.pbrt";
			xhttp.open("GET", url, true);
			xhttp.responseType = "arraybuffer";
			xhttp.send();
		}

		import init, { lib_entry } from "./pkg/rs_pbrt.js";
		init()
			.then(() => {
				document.getElementById("render_button").addEventListener("click", () => {
					let scene_value = document.getElementById("scenes").value;
					get_scene(scene_value);
				});
			});
	</script>
</body>

</html>